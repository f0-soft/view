View
=====
Осуществляет группу запросов к Flexo для подготовки данных.
Строит персональные шаблоны для передачи клиенту.



## Инструкция по установке
* Перед запуском провести установку зависимостей `npm install`
* Для работы требует `flexo` (которому требуются `collectioner` и `rabbit`), который надо поместить в `node_modules` на уровне package.json
* Перед запуском с настоящим `rabbit` следует очистить коллекции `test` и `test_join` 
* Для тестов с настоящим `rabbit`, в файле `test/index.js` в переменной `flexoConfig` надо заменить значение mock на `false`
* Тест запускать через `node test/index.js`



## Схема View
Позволяет определить:
* имя схемы;
* имя файла шаблона;
* один независимый (корневой) элементы ```flexo```;
* произвольное количество присоединяемых элементов ```flexo```;
* функции предварительной обработки запросов к ```flexo```;
* функции вычисления дополнительных параметров, запускаемые после сбора данных от ```flexo```.



## Шаблон View
Строится на сервере по имеющимся у пользователя правам доступа и персональным опциям.



## init( config, callback )
Выполняет инициализацию модуля

Параметры:
* ```config``` - объект
    * ```views``` - объект, содержит схемы ```View```
    * ```templatePath``` - строка, абсолютный путь к общему каталогу шаблонов ```View```
    * ```[templateTimeout]``` - число, время хранения шаблонов в памяти в миллисекундах
* ```callback( error, module )``` - функция, вызывается после инициализации




## GetTemplate( name, access, options, callback )
Выполняет компоновку шаблона для заданного ```view```

Параметры:
* ```name``` - строка, название обрабатываемой ```view```
* ```access``` - объект, содержит для каждого метода ```find```/```insert```/```modify```/```delete``` разрешенные для каждой ```flexo``` поля
* ```options``` - объект, содержит опции из прав доступа
* ```callback ( error, template, config )``` - функция, получает строку шаблона и объект настроек



## ProcessRequest( name, method, request, flexes, fields, options, callback )
Выполняет обработку запроса ```find```/```insert```/```modify```/```delete``` для заданного ```view```

Параметры:
* ```name``` - строка, название вызываемой ```view```
* ```method``` - строка, название вызываемого метода: ```find```/```insert```/```modify```/```delete```
* ```request``` - объект, запрос пользователя
* ```flexes``` - объект, содержит необходимые данной ```view``` экземпляры ```flexo```
* ```fields``` - объект, содержит для каждой ```flexo``` массив разрешенных полей для текущего метода
* ```options``` - объект, содержит опции из прав доступа
* ```callback( error, documents, [count])``` - функция, получает ответ



#### ProcessRequest - Find( request, fields, options, callback )
Производит поиск документов по ```request```.  
Возвращает объект массивов ответов ```flexo```, содержащих поля ```fields```.  
Если указан параметр ```inline``` возвращает массив ответов корневого ```flexo``` с «вписанными» зависимыми документами (дочерний документ вставляется в поле, по которому привязан, родительского документа).

__Селектор, отступ, лимит и сортировка возможны только по корневому ```flexo```.__

Параметры:
* ```request``` - объект, запрос пользователя
	* ```queries``` - объект, содержит запросы к соответствующим ```flexo```
    * ```[inline]``` - логическое, производить ли подстановку дочерних документов в родительские
    * ```[count]``` - логическое, опция запроса количества документов удовлетворяющих запросу
* ```fields``` - объект, содержит для каждой ```flexo``` массив полей, с которыми надо вернуть документы
* ```options``` - объект, содержит опции из прав доступа
* ```callback( error, documents, count )``` - функция, получает объект, содержащий ответ от каждой ```flexo``` (массив документов), и количество документов удовлетворяющих запросу



#### ProcessRequest - Insert( request, fields, options, callback )
Производит сохранение документов через соответствующие ```flexo```

Параметры:
* ```request``` - объект, запрос пользователя
	* ```queries``` - объект, содержит документы или массивы документов для соответствующих ```flexo```
* ```fields``` - объект, содержит для каждой ```flexo``` массив полей, с которыми надо вернуть сохраненные документы
* ```options``` - объект, содержит опции из прав доступа
* ```callback( error, documents )``` - функция, получает объект, содержащий ответ от каждой ```flexo``` (массив сохраненных документов)



#### ProcessRequest - Modify( request, options, callback )
Производит изменение документов через соответствующие ```flexo```

Параметры:
* ```request``` - объект, запрос пользователя
	* ```queries``` - объект, содержит запросы или массивы запросов к соответствующим ```flexo``` (запросы должны содержать только ```_id```)
* ```options``` - объект, содержит опции из прав доступа
* ```callback( error, documents )``` - функция, получает объект, содержащий ответ от каждой ```flexo``` (массив объектов с ```_id``` и ```tsUpdate```)



#### ProcessRequest - Delete( request, options, callback )
Производит удаление документов через соответствующие ```flexo```

Параметры:
* ```request``` - объект, запрос пользователя
	* ```queries``` - объект, содержит запросы или массивы запросов к соответствующим ```flexo``` (запросы должны содержать только ```_id```)
* ```options``` - объект, содержит опции из прав доступа
* ```callback( error, documents )``` - функция, получает объект, содержащий ответ от каждой ```flexo``` (массив объектов с ```_id``` удаленных документов)
